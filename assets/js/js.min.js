// @ts-nocheck
const locale=localStorage.getItem("films");function showFilms(){let e=JSON.parse(localStorage.getItem("films")).items,t=document.querySelector(".films-wrapper");e.forEach((e=>{let a=`\n        <button class="film-item" data-name="${e.nameRu}" data-id="${e.kinopoiskId}">\n            <div>\n                <img src="${e.posterUrl}">\n            </div>\n        </button>\n    `;t.insertAdjacentHTML("afterbegin",a)}))}showFilms();let data=new Date,day=data.getDate();const currentDate=new Date,getDatesInRange=e=>{const t=[];for(let a=-7;a<=7;a++){const c=new Date(e);c.setDate(e.getDate()+a),t.push(c.toISOString().split("T")[0].split("-").reverse().join("."))}return t},datesRange=getDatesInRange(currentDate),isPastDate=e=>{const[t,a,c]=e.split(".").map(Number),l=new Date(c,a-1,t),o=new Date;return o.setHours(0,0,0,0),l<o},pastDates=datesRange.filter(isPastDate),dateItems=document.querySelector(".date-items");datesRange.forEach((e=>{let t;t=pastDates.includes(e)?"past":"active";let a=`<li class="${t}" data-item="${e}">${e}</li>`;dateItems.insertAdjacentHTML("beforeEnd",a)}));const closeModal=document.querySelector(".close-modal-btn");closeModal.addEventListener("click",(()=>{modal.classList.remove("open-modal")}));const placePanelClose=document.querySelector(".place-panel-close");placePanelClose.addEventListener("click",(()=>{document.querySelector(".places-wrapper").classList.remove("open-wrap"),clearPlaceAndDate()}));const modal=document.querySelector(".modal");function openModal(e){modal.classList.add("open-modal"),bookedItem.name=e.getAttribute("data-name"),bookedItem.id=e.getAttribute("data-id")}const films=document.querySelectorAll(".film-item");films.forEach((e=>{e.addEventListener("click",(()=>{document.querySelector(".film-name-title").textContent=e.getAttribute("data-name");let t=e.children[0].children[0].getAttribute("src");document.querySelector(".modal-current-film-img").setAttribute("src",t),openModal(e)}))}));let bookedItem={id:"",name:"",data:[]},currentData={date:"",timePlace:[]},timeAndPlace={time:"10:00",place:[]};const dates=document.querySelectorAll(".date-items li");let cd,allPlaceTime=document.querySelectorAll(".place");dates.forEach((e=>{e.addEventListener("click",(()=>{let t=e.textContent;currentData.date=t,document.querySelector(".places-wrapper").classList.add("open-wrap"),isPastDate(t.replace(":","."))?placeItems.forEach((e=>{e.classList.add("no-active")})):placeItems.forEach((e=>{e.classList.remove("no-active")}));let a=JSON.parse(localStorage.getItem("data")).find((e=>e.id===bookedItem.id));console.log(a.data),current=a.data.find((t=>t.date===e.textContent));let c=current.timePlace;allPlaceTime.forEach((e=>{let t=e.getAttribute("data-time"),a=c.find((e=>e.time===t)).place;e.childNodes.forEach((e=>{a.forEach((t=>{e.textContent===t&&e.classList.add("sold")}))}))}))}))}));const time=document.querySelectorAll(".time li");time.forEach((e=>{e.addEventListener("click",(()=>{time.forEach((e=>{e.classList.remove("checked"),allPlaceTime.forEach((e=>{e.style="display: none;"}))})),e.classList.add("checked");let t=e.textContent;allPlaceTime.forEach((e=>{e.getAttribute("data-time")===t&&(e.style="display: flex;")})),timeAndPlace.time=e.textContent}))}));const placeItems=document.querySelectorAll(".place li");let places=[];placeItems.forEach((e=>{e.addEventListener("click",(()=>{let t=e.textContent;if(e.classList.toggle("checked"),places.includes(t)){let e=places.filter((e=>e!==t));places=e}else places.push(t);timeAndPlace.place=places,activeBtn()}))}));const acceptBtn=document.querySelector(".accept-btn");function saveDate(){if(null!==localStorage.getItem("data")){let e=JSON.parse(localStorage.getItem("data")),t=e.find((e=>e.id===bookedItem.id));if(t){let a=t.data.find((e=>e.date===bookedItem.data[0].date));if(a){let c=a.timePlace;c.forEach((a=>{if(bookedItem.data[0].timePlace[0].time===a.time){a.place.push(...bookedItem.data[0].timePlace[0].place);const c=e.map((e=>e.id===t.id?t:e));localStorage.setItem("data",JSON.stringify(c)),console.log("Тут")}else{if(!c.some((e=>e.time===bookedItem.data[0].timePlace[0].time))){c.push(bookedItem.data[0].timePlace[0]),console.log(t);const a=e.map((e=>e.id===t.id?t:e));localStorage.setItem("data",JSON.stringify(a)),console.log("Тут 2")}}}))}else{t.data.push(bookedItem.data[0]);const a=e.map((e=>e.id===t.id?t:e));localStorage.setItem("data",JSON.stringify(a)),console.log("Тут 3")}}else e.push(bookedItem),localStorage.setItem("data",JSON.stringify(e)),console.log("Тут 5")}else localStorage.setItem("data",JSON.stringify([bookedItem])),console.log("Тут 4");document.querySelector(".message-seccesfull").classList.add("open"),setTimeout((()=>{document.querySelector(".message-seccesfull").classList.remove("open")}),1500)}let timesAndPlaece;acceptBtn.addEventListener("click",(()=>{currentData.timePlace.push(timeAndPlace),bookedItem.data.push(currentData),saveDate()}));const cancelBtn=document.querySelector(".cancel-btn");function activeBtn(){0!==timeAndPlace.place.length?acceptBtn.classList.add("active-btn"):acceptBtn.classList.remove("active-btn")}function clearPlaceAndDate(){placeItems.forEach((e=>{e.classList.remove("sold")})),time.forEach(((e,t)=>{e.classList.remove("checked"),0===t&&e.classList.add("checked")}))}cancelBtn.addEventListener("click",(()=>{document.querySelectorAll(".place li").forEach((e=>{e.classList.remove("checked")})),acceptBtn.classList.remove("active-btn")}));